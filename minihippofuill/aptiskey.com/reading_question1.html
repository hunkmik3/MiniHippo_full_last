<!DOCTYPE html>
<html lang="en">

<!-- Mirrored from aptiskey.com/reading_question1.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 07 Nov 2025 10:17:29 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Thêm thẻ này -->
    <title>Mini Hippo - Reading Practice</title>
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="css/readingkey.css" rel="stylesheet">
    <link href="css/lesson-ui.css" rel="stylesheet">
    <style>
        /* Hide content initially when loading lesson script */
        body.lesson-loading #question1 {
            opacity: 0;
            pointer-events: none;
        }
        body.lesson-loading #question1 * {
            visibility: hidden;
        }
        /* Hide by default if lesson parameter exists */
        #question1.lesson-loading {
            opacity: 0;
            pointer-events: none;
        }
        #question1.lesson-loading * {
            visibility: hidden;
        }
        
        /* Loading indicator styles */
        #lesson-loading-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
            background: white;
            padding: 30px 50px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            text-align: center;
            display: none;
        }
        
        body.lesson-loading #lesson-loading-indicator {
            display: block;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 18px;
            color: #333;
            font-weight: 500;
        }
    </style>
    <script>
        // Check for lesson parameter and add inline style to hide content immediately
        (function() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('lesson')) {
                // Add style to hide #question1 immediately with an ID so we can remove it later
                const style = document.createElement('style');
                style.id = 'lesson-loading-style';
                style.textContent = '#question1 { opacity: 0 !important; pointer-events: none !important; } #question1 * { visibility: hidden !important; }';
                document.head.appendChild(style);
                
                // Store reference to remove later
                window._lessonLoadingStyle = style;
                
                // Show loading indicator when body is ready
                if (document.body) {
                    document.body.classList.add('lesson-loading');
                } else {
                    document.addEventListener('DOMContentLoaded', function() {
                        document.body.classList.add('lesson-loading');
                    });
                }
            }
        })();
    </script>
    <script>
        // Dynamic JS loading based on lesson ID parameter
        (function() {
            const urlParams = new URLSearchParams(window.location.search);
            const lessonId = urlParams.get('lesson');
            const part = 1;
            let lessonScriptLoaded = false;
            
            // Function to hide/show content
            function setLoadingState(isLoading) {
                if (document.body) {
                    if (isLoading) {
                        document.body.classList.add('lesson-loading');
                    } else {
                        document.body.classList.remove('lesson-loading');
                    }
                }
                // Also set on question container directly
                const questionContainer = document.getElementById('question1');
                if (questionContainer) {
                    if (isLoading) {
                        questionContainer.classList.add('lesson-loading');
                    } else {
                        questionContainer.classList.remove('lesson-loading');
                    }
                }
                
                // Remove inline style if it exists
                if (!isLoading) {
                    const loadingStyle = document.getElementById('lesson-loading-style');
                    if (loadingStyle) {
                        loadingStyle.remove();
                    }
                    // Also check window reference
                    if (window._lessonLoadingStyle && window._lessonLoadingStyle.parentNode) {
                        window._lessonLoadingStyle.remove();
                    }
                }
            }
            
            // Hide content if loading lesson (wait for DOM)
            if (lessonId) {
                if (document.body) {
                    setLoadingState(true);
                } else {
                    // Wait for DOM
                    if (document.readyState === 'loading') {
                        document.addEventListener('DOMContentLoaded', function() {
                            setLoadingState(true);
                        });
                    } else {
                        // DOM already ready
                        setLoadingState(true);
                    }
                }
            }
            
            async function loadLessonScript() {
                // If no lesson ID, load default script immediately and return
                if (!lessonId) {
                    console.log('No lesson parameter - loading default/original lesson');
                    loadDefaultScript();
                    return; // Exit early, don't do anything else
                }
                
                // Only proceed with lesson loading if lessonId exists
                try {
                    console.log('Loading lesson with ID:', lessonId);
                    // Fetch lesson data from API
                    const response = await fetch(`/api/lessons/get?id=${lessonId}`);
                    const result = await response.json();
                    
                    console.log('Lesson data response:', result);
                    
                    if (response.ok && result.lesson) {
                        const lesson = result.lesson;
                        console.log('Lesson found:', lesson);
                        
                        // Get GitHub raw URL from API
                        const scriptResponse = await fetch(`/api/lessons/get-script-url?filePath=${encodeURIComponent(lesson.file_path)}`);
                        const scriptResult = await scriptResponse.json();
                        
                        console.log('Script URL response:', scriptResult);
                        
                        // Fetch script content and execute directly (handles DOMContentLoaded issue)
                        const scriptPath = `/api/lessons/get-script?filePath=${encodeURIComponent(lesson.file_path)}&v=${new Date().getTime()}`;
                        console.log('Fetching script content from API proxy:', scriptPath);
                        
                        try {
                            const scriptResponse = await fetch(scriptPath);
                            if (!scriptResponse.ok) {
                                throw new Error(`Failed to fetch script: ${scriptResponse.status}`);
                            }
                            
                            const scriptContent = await scriptResponse.text();
                            console.log('Script content fetched, executing...');
                            
                            // Replace DOMContentLoaded with immediate execution if DOM is ready
                            let modifiedContent = scriptContent;
                            if (document.readyState !== 'loading') {
                                // DOM already ready, replace DOMContentLoaded with IIFE
                                console.log('DOM already ready, replacing DOMContentLoaded with immediate execution');
                                // Replace the DOMContentLoaded listener with an IIFE
                                modifiedContent = scriptContent.replace(
                                    /document\.addEventListener\(['"]DOMContentLoaded['"],\s*function\(\)\s*\{/g,
                                    '(function() {'
                                );
                                // Replace the closing }); with })(); to execute immediately
                                // Find the last }); that closes the DOMContentLoaded function
                                const lastMatch = modifiedContent.lastIndexOf('});');
                                if (lastMatch !== -1 && modifiedContent !== scriptContent) {
                                    modifiedContent = modifiedContent.substring(0, lastMatch) + '})();' + modifiedContent.substring(lastMatch + 3);
                                }
                            } else {
                                console.log('DOM still loading, keeping DOMContentLoaded listener');
                            }
                            
                            // Execute the script
                            const scriptElement = document.createElement('script');
                            scriptElement.textContent = modifiedContent;
                            document.head.appendChild(scriptElement);
                            
                            // Script executes synchronously, so wait a bit for DOM updates
                            // Use multiple fallbacks to ensure content is shown
                            
                            // Immediate: remove style after script execution
                            setTimeout(function() {
                                setLoadingState(false);
                                // Hide loading indicator
                                const loadingIndicator = document.getElementById('lesson-loading-indicator');
                                if (loadingIndicator) {
                                    loadingIndicator.style.display = 'none';
                                }
                                console.log('Removed loading state (immediate)');
                            }, 100);
                            
                            // Wait for content to be rendered
                            function showContentWhenReady() {
                                const container = document.getElementById('questions-container');
                                const question1 = document.getElementById('question1');
                                
                                // Check if content is rendered
                                if ((container && container.children.length > 0) || 
                                    (question1 && question1.innerHTML.trim().length > 100)) {
                                    // Content is ready
                                    if (!lessonScriptLoaded) {
                                        lessonScriptLoaded = true;
                                        setLoadingState(false);
                                        // Hide loading indicator
                                        const loadingIndicator = document.getElementById('lesson-loading-indicator');
                                        if (loadingIndicator) {
                                            loadingIndicator.style.display = 'none';
                                        }
                                        console.log('Lesson script executed successfully, content visible');
                                    }
                                } else {
                                    // Check again after a short delay
                                    setTimeout(showContentWhenReady, 50);
                                }
                            }
                            
                            // Start checking after script execution
                            requestAnimationFrame(function() {
                                requestAnimationFrame(function() {
                                    showContentWhenReady();
                                });
                            });
                            
                            // Final fallback: force show after 300ms
                            setTimeout(function() {
                                if (!lessonScriptLoaded) {
                                    lessonScriptLoaded = true;
                                    setLoadingState(false);
                                    // Hide loading indicator
                                    const loadingIndicator = document.getElementById('lesson-loading-indicator');
                                    if (loadingIndicator) {
                                        loadingIndicator.style.display = 'none';
                                    }
                                    console.log('Lesson script loaded (final fallback)');
                                }
                            }, 300);
                            
                            return;
                        } catch (error) {
                            console.error('Failed to fetch/execute script from API proxy:', error);
                            setLoadingState(false);
                            // Hide loading indicator on error
                            const loadingIndicator = document.getElementById('lesson-loading-indicator');
                            if (loadingIndicator) {
                                loadingIndicator.style.display = 'none';
                            }
                            // Try GitHub raw URL as fallback
                            if (scriptResponse.ok && scriptResult.scriptUrl) {
                                console.log('Trying GitHub raw URL fallback...');
                                const rawScript = document.createElement('script');
                                rawScript.src = scriptResult.scriptUrl + '?v=' + new Date().getTime();
                                rawScript.defer = true;
                                rawScript.onload = function() {
                                    setLoadingState(false);
                                    const loadingIndicator = document.getElementById('lesson-loading-indicator');
                                    if (loadingIndicator) {
                                        loadingIndicator.style.display = 'none';
                                    }
                                };
                                rawScript.onerror = function() {
                                    console.error('GitHub raw URL also failed, trying local...');
                                    const localPath = lesson.file_path;
                                    const localScript = document.createElement('script');
                                    localScript.src = (localPath.startsWith('js/') ? localPath : 'js/' + localPath) + '?v=' + new Date().getTime();
                                    localScript.defer = true;
                                    localScript.onload = function() {
                                        setLoadingState(false);
                                        const loadingIndicator = document.getElementById('lesson-loading-indicator');
                                        if (loadingIndicator) {
                                            loadingIndicator.style.display = 'none';
                                        }
                                    };
                                    localScript.onerror = function() {
                                        console.error('All methods failed, loading default');
                                        setLoadingState(false);
                                        loadDefaultScript();
                                    };
                                    document.head.appendChild(localScript);
                                };
                                document.head.appendChild(rawScript);
                                return;
                            } else {
                                console.log('Loading default script');
                                loadDefaultScript();
                                return;
                            }
                        }
                    } else {
                        console.error('Lesson not found or error:', result);
                        setLoadingState(false);
                        const loadingIndicator = document.getElementById('lesson-loading-indicator');
                        if (loadingIndicator) {
                            loadingIndicator.style.display = 'none';
                        }
                        // Fallback to default script if lesson not found
                        console.log('Lesson not found, loading default script');
                        loadDefaultScript();
                    }
                } catch (error) {
                    console.error('Error loading lesson:', error);
                    console.error('Error details:', error.stack);
                    setLoadingState(false);
                    const loadingIndicator = document.getElementById('lesson-loading-indicator');
                    if (loadingIndicator) {
                        loadingIndicator.style.display = 'none';
                    }
                    // Fallback to default script on error
                    console.log('Error loading lesson, loading default script');
                    loadDefaultScript();
                }
            }
            
            function loadDefaultScript() {
                console.log('loadDefaultScript called, DOM readyState:', document.readyState);
                const scriptUrl = 'js/reading_question/reading_question1.js?v=' + new Date().getTime();
                
                // Always fetch and execute directly to handle DOMContentLoaded issue
                console.log('Fetching script content directly');
                fetch(scriptUrl)
                        .then(response => {
                            console.log('Fetch response status:', response.status);
                            if (!response.ok) {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }
                            return response.text();
                        })
                        .then(scriptContent => {
                            console.log('Script content fetched, length:', scriptContent.length);
                            let modifiedContent = scriptContent.replace(
                                /document\.addEventListener\(['"]DOMContentLoaded['"],\s*function\(\)\s*\{/g,
                                '(function() {'
                            );
                            const lastMatch = modifiedContent.lastIndexOf('});');
                            if (lastMatch !== -1 && modifiedContent !== scriptContent) {
                                modifiedContent = modifiedContent.substring(0, lastMatch) + '})();' + modifiedContent.substring(lastMatch + 3);
                                console.log('Replaced DOMContentLoaded with IIFE');
                            } else {
                                console.log('No DOMContentLoaded found, using script as-is');
                            }
                            const scriptElement = document.createElement('script');
                            scriptElement.textContent = modifiedContent;
                            
                            // Add error handler
                            scriptElement.onerror = function(error) {
                                console.error('Error executing script:', error);
                            };
                            
                            document.head.appendChild(scriptElement);
                            console.log('Default script executed successfully');
                            
                            // Check if content was rendered after a short delay
                            setTimeout(function() {
                                const container = document.getElementById('questions-container');
                                if (container && container.children.length > 0) {
                                    console.log('Content rendered successfully, children:', container.children.length);
                                } else {
                                    console.warn('Content not rendered yet, container:', container);
                                }
                            }, 500);
                        })
                        .catch(error => {
                            console.error('Failed to fetch/execute default script:', error);
                            // Fallback: try normal script loading
                            console.log('Trying fallback: normal script loading');
            const script = document.createElement('script');
                            script.src = scriptUrl;
            script.defer = true;
                            script.onload = function() {
                                console.log('Fallback script loaded');
                            };
                            script.onerror = function() {
                                console.error('Fallback script also failed');
                            };
            document.head.appendChild(script);
                        });
            }
            
            loadLessonScript();
        })();
    </script>
</head>

<body>
<!-- Loading Indicator -->
<div id="lesson-loading-indicator">
    <div class="loading-spinner"></div>
    <div class="loading-text">Đang tải bài học...</div>
</div>
<!-- ====================================================================================
                  HEADER SECTION
======================================================================================== -->
<div class="header d-flex justify-content-between align-items-center p-3 bg-white text-dark shadow-sm">
  <!-- Left Section -->
  <div class="d-flex align-items-center">
    <a href="reading_question-2.html" class="me-3 text-decoration-none text-dark fs-4">
      <i class="bi bi-house-door-fill me-2"></i> <!-- House Icon from Bootstrap Icons -->
      <span>Mini Hippo</span>
    </a>
  </div>

  <!-- Center Section (Countdown Timer) -->
  <div class="d-flex align-items-center">
    <span class="time-remaining-label me-2 fs-6">Time remaining:</span>
    <span class="countdown fs-4" id="countdownTimer">34:00</span>
  </div>

  <!-- Right Section (Current Step) -->
  <div id="question_step" class="fs-5 fw-bold">
    Reading Question 1
  </div>
</div>
<!-- ====================================================================================
                  Question 1
======================================================================================== -->
    <!-- Question 1 -->
    <div id = "question1" class="container py-5">
        <h1 id = "question1_header" class="mb-4">Question 1</h1>
        <p class="mb-4">Choose the word that fits in the gap. The first one is done for you.</p>
        <a>Hey Lewis,<br><br></a>
        <form id="questionForm">
            <div id="questions-container"></div>
        </form>
        <a><br>Love,<br>Helen<br><br><br></a>
    </div>




    


<!-- ============================================
                  Modal for Test Result
================================================ -->
<div class="modal fade" id="resultModal" tabindex="-1" aria-labelledby="resultModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="resultModalLabel">Test and Answer Review keys 001</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center">
        <h5 id="totalScore"></h5> <!-- Hiển thị điểm tổng -->
        <h5 id="scoreClassification"></h5> <!-- Hiển thị phân loại điểm -->

        <!-- Bảng so sánh kết quả -->
        <table class="table table-bordered mt-4">
          <thead>
            <tr>
              <th scope="col">Your Answer</th>
              <th scope="col">Correct Answer</th>
            </tr>
          </thead>
          <tbody id="comparisonTableBody">
            <!-- Các kết quả so sánh sẽ được hiển thị tại đây -->
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>






<!-- ============================================
                  FOOTER SECTION
================================================ -->
<div class="footer">
    <button class="btn btn-back" id="backButton">Back</button>
    <button class="btn btn-check-result" id="checkResultButton">Check result</button>
    <button class="btn btn-next" id="nextButton">Next</button>
</div>


<!-- ============================================
                  POPUP XÁC NHẬN BÀI THI
================================================ -->
    <!-- Modal Popup for Confirm and Cancel -->
    <div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmationModalLabel">Confirm Submission</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to submit your test? Once submitted, you can't change your answers.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmSubmitBtn" data-bs-dismiss="modal">Submit</button>
                </div>
            </div>
        </div>
    </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>